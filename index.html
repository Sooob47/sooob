<!DOCTYPE html>
<html lang="ko">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<head>
    <!-- Previous head content remains the same until script section -->
    
    <!-- Rest of the HTML remains identical until the script section -->
    
    <script>
        // Feather 아이콘 초기화
        feather.replace()

        $(document).ready(function() {
            var addrScript = 'https://script.google.com/macros/s/AKfycbw0xMmx7d1yge0Ole2ml6gsPDiCtLoiYj2avWuO4Emjfx_9ky-Y4qjtyKtEtXI5DUWP/exec';

            // 초기 방문자 데이터 전송
            var initialData = JSON.stringify({
                "name": "name",
                "phone": "010-0000-0000",
                "email": "example@yonsei.ac.kr",
                "qa": "hello"
            });

            $.ajax({
                url: addrScript + '?action=insert&table=visitors&data=' + initialData,
                dataType: 'jsonp',
                success: function(response) {
                    console.log('성공 - ', JSON.stringify(response));
                },
                error: function(xhr) {
                    console.log('실패 - ', JSON.stringify(xhr));
                }
            });

            // 방문자 정보 전송
            var visitorData = JSON.stringify({
                "name": getUVfromCookie(),
                "phone": window.location.href,
                "email": ip,
                "qa": document.referrer
            });

            $.ajax({
                url: addrScript + '?action=insert&table=visitors&data=' + visitorData,
                dataType: 'jsonp',
                success: function(response) {
                    console.log('성공 - ', JSON.stringify(response));
                },
                error: function(xhr) {
                    console.log('실패 - ', JSON.stringify(xhr));
                }
            });

            // 문의하기 폼 제출
            $("#submit").on("click", function() {
                const name = $("#submit-name").val();
                const phone = $("#submit-phone").val();
                const email = $("#submit-email").val();
                const qa = $("#submit-qa").val();

                function validateEmail(email) {
                    var re = /^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;
                    return re.test(email);
                }

                if (email == '' || !validateEmail(email)) {
                    alert("이메일이 유효하지 않아 알림을 드릴 수가 없습니다. ");
                    return;
                }

                var formData = JSON.stringify({
                    "name": name,
                    "phone": phone,
                    "email": email,
                    "qa": qa
                });

                $.ajax({
                    url: 'https://script.google.com/macros/s/AKfycbzrw1Ouk9-LeF0H2eEzzI-4RWOgQp5O0YvNQTfzCkI4BcIDe0eJDQ0whbCr2svCnh-9XA/exec' + formData,
                    dataType: 'jsonp',
                    success: function(response) {
                        console.log('성공 - ', JSON.stringify(response));
                        alert(JSON.stringify(response));
                        $('#submit-name').val('');
                        $('#submit-phone').val('');
                        $('#submit-email').val('');
                        $('#submit-qa').val('');
                    },
                    error: function(xhr) {
                        console.log('실패 - ', JSON.stringify(xhr));
                    }
                });
            });
        });
    </script>
</body>
</html>